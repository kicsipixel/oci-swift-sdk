name: CI

on:
    push:
        branches:
            - listobject-fix
    pull_request:
    workflow_dispatch:

jobs:
    linux:
        runs-on: ubuntu-latest
        container:
            image: swift:6.1
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Show Swift version
              run: swift --version

            - name: Inject OCI config and key
              run: |
                  mkdir -p /root/.oci/Personal
                  echo "${{ secrets.OCI_CONFIG_FILE_CONTENT }}" > /root/.oci/config
                  echo "${{ secrets.OCI_API_KEY_CONTENT }}" > /root/.oci/Personal/oci_personal_api_key.pem
                  chmod 600 /root/.oci/Personal/oci_personal_api_key.pem

            - name: Run Linux-safe tests
              env:
                  OCI_CONFIG_FILE: /root/.oci/config
                  OCI_PROFILE: DEFAULT
              run: swift test
